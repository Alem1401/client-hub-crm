<div class="analytics-page">
  <!-- Header Section -->
  <div class="header-section">
    <div class="header-content">
      <h1>
        <mat-icon>analytics</mat-icon>
        Reports & Analytics
      </h1>
      <p class="header-subtitle">Track your performance and business insights</p>
    </div>
    <div class="header-actions">
      <div class="period-selector">
        <mat-form-field appearance="outline">
          <mat-label>Time Period</mat-label>
          <mat-select [(ngModel)]="selectedPeriod" (selectionChange)="onPeriodChange()">
            <mat-option value="week">This Week</mat-option>
            <mat-option value="month">This Month</mat-option>
            <mat-option value="quarter">This Quarter</mat-option>
            <mat-option value="year">This Year</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>
  </div>

  <!-- KPI Stats Cards -->
  <div class="stats-grid">
    <div class="stat-card revenue">
      <div class="stat-icon">
        <mat-icon>payments</mat-icon>
      </div>
      <div class="stat-content">
        <span class="stat-value">{{ formatCurrency(totalRevenue) }}</span>
        <span class="stat-label">Total Revenue</span>
      </div>
      <div class="stat-trend" [ngClass]="getGrowthClass(revenueGrowth)">
        <mat-icon>{{ getGrowthIcon(revenueGrowth) }}</mat-icon>
        <span>{{ formatPercentage(revenueGrowth) }}</span>
      </div>
    </div>

    <div class="stat-card policies">
      <div class="stat-icon">
        <mat-icon>description</mat-icon>
      </div>
      <div class="stat-content">
        <span class="stat-value">{{ newPoliciesThisMonth }}</span>
        <span class="stat-label">New Policies</span>
      </div>
      <div class="stat-trend positive">
        <mat-icon>add_circle</mat-icon>
        <span>This period</span>
      </div>
    </div>

    <div class="stat-card clients">
      <div class="stat-icon">
        <mat-icon>person_add</mat-icon>
      </div>
      <div class="stat-content">
        <span class="stat-value">{{ newClientsThisMonth }}</span>
        <span class="stat-label">New Clients</span>
      </div>
      <div class="stat-trend" [ngClass]="getGrowthClass(clientGrowth)">
        <mat-icon>{{ getGrowthIcon(clientGrowth) }}</mat-icon>
        <span>{{ formatPercentage(clientGrowth) }}</span>
      </div>
    </div>
  </div>

  <!-- Main Content Grid -->
  <div class="content-grid">
    <!-- Left Column - Charts -->
    <div class="charts-column">
      <!-- Revenue Trend Chart -->
      <div class="content-card">
        <div class="card-header">
          <h2>
            <mat-icon>show_chart</mat-icon>
            Revenue Trend
          </h2>
          <span class="card-subtitle">Monthly revenue over time</span>
        </div>
        <div class="card-content">
          <div class="chart-container">
            <canvas baseChart
              type="bar"
              [data]="revenueChartData"
              [options]="revenueChartOptions">
            </canvas>
          </div>
        </div>
      </div>

      <!-- Policy Creation Trend -->
      <div class="content-card">
        <div class="card-header">
          <h2>
            <mat-icon>insert_chart</mat-icon>
            Policy Creation Trend
          </h2>
          <span class="card-subtitle">New policies per month</span>
        </div>
        <div class="card-content">
          <div class="chart-container">
            <canvas baseChart
              type="line"
              [data]="policyChartData"
              [options]="policyChartOptions">
            </canvas>
          </div>
        </div>
      </div>

      <!-- Client Acquisition Trend -->
      <div class="content-card">
        <div class="card-header">
          <h2>
            <mat-icon>group_add</mat-icon>
            Client Acquisition
          </h2>
          <span class="card-subtitle">New clients per month</span>
        </div>
        <div class="card-content">
          <div class="chart-container">
            <canvas baseChart
              type="bar"
              [data]="clientChartData"
              [options]="clientChartOptions">
            </canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column - Summary Cards -->
    <div class="sidebar">
      <!-- Policy Summary -->
      <div class="content-card">
        <div class="card-header">
          <h2>
            <mat-icon>assessment</mat-icon>
            Policy Summary
          </h2>
        </div>
        <div class="card-content">
          <div class="summary-list">
            <div class="summary-item">
              <div class="summary-icon total">
                <mat-icon>folder</mat-icon>
              </div>
              <div class="summary-info">
                <span class="summary-label">Total Policies</span>
                <span class="summary-value">{{ totalPolicies }}</span>
              </div>
            </div>
            <div class="summary-item">
              <div class="summary-icon new">
                <mat-icon>add_circle</mat-icon>
              </div>
              <div class="summary-info">
                <span class="summary-label">New This Month</span>
                <span class="summary-value">{{ newPoliciesThisMonth }}</span>
              </div>
            </div>
            <div class="summary-item">
              <div class="summary-icon expired">
                <mat-icon>event_busy</mat-icon>
              </div>
              <div class="summary-info">
                <span class="summary-label">Expired</span>
                <span class="summary-value">{{ expiredPolicies }}</span>
              </div>
            </div>
            <div class="summary-item">
              <div class="summary-icon average">
                <mat-icon>paid</mat-icon>
              </div>
              <div class="summary-info">
                <span class="summary-label">Avg. Policy Value</span>
                <span class="summary-value">{{ formatCurrency(averagePolicyValue) }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Policy Distribution -->
      <div class="content-card">
        <div class="card-header">
          <h2>
            <mat-icon>pie_chart</mat-icon>
            Policy Distribution
          </h2>
        </div>
        <div class="card-content">
          <div class="chart-container-small">
            <canvas baseChart
              type="doughnut"
              [data]="distributionChartData"
              [options]="distributionChartOptions">
            </canvas>
          </div>
        </div>
      </div>

      <!-- Top Clients -->
      <div class="content-card">
        <div class="card-header">
          <h2>
            <mat-icon>star</mat-icon>
            Top Clients
          </h2>
          <a routerLink="/dashboard/clients" class="view-all-link">
            View All
            <mat-icon>arrow_forward</mat-icon>
          </a>
        </div>
        <div class="card-content">
          <div class="top-clients-list">
            @for (client of topClients; track client.name; let i = $index) {
            <div class="top-client-item">
              <div class="rank-badge">{{ i + 1 }}</div>
              <div class="client-info">
                <span class="client-name">{{ client.name }}</span>
                <span class="client-detail">{{ client.policyCount }} policies</span>
              </div>
              <div class="client-value">{{ formatCurrency(client.totalPremium) }}</div>
            </div>
            }
            @if (topClients.length === 0) {
            <div class="empty-state small">
              <mat-icon>person_search</mat-icon>
              <p>No client data available</p>
            </div>
            }
          </div>
        </div>
      </div>

      <!-- Quick Stats -->
      <div class="content-card">
        <div class="card-header">
          <h2>
            <mat-icon>speed</mat-icon>
            Quick Stats
          </h2>
        </div>
        <div class="card-content">
          <div class="quick-stats-grid">
            <div class="quick-stat">
              <span class="quick-stat-value">{{ totalClients }}</span>
              <span class="quick-stat-label">Total Clients</span>
            </div>
            <div class="quick-stat">
              <span class="quick-stat-value">{{ averagePoliciesPerClient | number:'1.1-1' }}</span>
              <span class="quick-stat-label">Policies/Client</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
